<!doctype html>
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>AndroidAnnotations</title>
	<meta name="description" content="">
	<meta name="author" content="">

	<meta name="viewport" content="width=device-width,initial-scale=1">

	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/shCoreDefault.css">

	<script src="js/libs/modernizr-2.0.min.js"></script>
	<script src="js/libs/shCore.js"></script>
	<script src="js/libs/shBrushJava.js"></script>

</head>
<body>
	<div id="header-container">
		<header class="wrapper">
			<h1 id="title">Android Annotations</h1>
            <div></div>
        </header>
	</div>
	<div id="main" class="wrapper-content">
        <!--<aside>
            <ul>
                <li><a href="#">Google plus</a></li>
                <li><a href="#">Google code</a></li>
                <li><a href="#">Twitter</a></li>
            </ul>
        </aside>-->
		<article>
            <!--<iframe src="http://player.vimeo.com/video/20683891?title=0&amp;byline=0&amp;portrait=0" width="600" height="425" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>-->
            <div class="column">
                <h3>Before</h3>
                <script type="syntaxhighlighter" class="brush: java"><![CDATA[
public class BookmarksToClipboardActivity extends Activity {
	
	BookmarkAdapter adapter;

	ListView bookmarkList;

	EditText search;

	BookmarkApplication application;

	Animation fadeIn;

	ClipboardManager clipboardManager;

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);

		requestWindowFeature(Window.FEATURE_NO_TITLE);
		getWindow().setFlags(FLAG_FULLSCREEN, FLAG_FULLSCREEN);

		setContentView(R.layout.bookmarks);

		bookmarkList = (ListView) findViewById(R.id.bookmarkList);
		search = (EditText) findViewById(R.id.search);
		application = (BookmarkApplication) getApplication();
		fadeIn = AnimationUtils.loadAnimation(this, anim.fade_in);
		clipboardManager = ((ClipboardManager) getSystemService(Context.CLIPBOARD_SERVICE));

		View updateBookmarksButton1 = findViewById(R.id.updateBookmarksButton1);
		updateBookmarksButton1.setOnClickListener(new OnClickListener() {

			@Override
			public void onClick(View v) {
				updateBookmarksClicked();
			}
		});

		View updateBookmarksButton2 = findViewById(R.id.updateBookmarksButton2);
		updateBookmarksButton2.setOnClickListener(new OnClickListener() {

			@Override
			public void onClick(View v) {
				updateBookmarksClicked();
			}
		});

		bookmarkList.setOnItemClickListener(new OnItemClickListener() {

			@Override
			public void onItemClick(AdapterView<?> parent, View view, int position, long id) {
				Bookmark selectedBookmark = (Bookmark) parent.getAdapter().getItem(position);
				bookmarkListItemClicked(selectedBookmark);
			}
		});

		initBookmarkList();
	}

	void initBookmarkList() {
		adapter = new BookmarkAdapter(this);
		bookmarkList.setAdapter(adapter);
	}

	void updateBookmarksClicked() {
		UpdateBookmarksTask task = new UpdateBookmarksTask();

		task.execute(search.getText().toString(), application.getUserId());
	}
	
	private static final String BOOKMARK_URL = //
	"http://www.bookmarks.com/bookmarks/{userId}?search={search}";
	
	
	private class UpdateBookmarksTask extends AsyncTask<String, Void, Bookmarks> {

		@Override
		protected Bookmarks doInBackground(String... params) {
			String searchString = params[0];
			String userId = params[1];

			RestTemplate client = new RestTemplate();
			HashMap<String, Object> args = new HashMap<String, Object>();
			args.put("search", searchString);
			args.put("userId", userId);
			HttpHeaders httpHeaders = new HttpHeaders();
			HttpEntity<Bookmarks> request = new HttpEntity<Bookmarks>(httpHeaders);
			ResponseEntity<Bookmarks> response = client.exchange( //
					BOOKMARK_URL, HttpMethod.GET, request, Bookmarks.class, args);
			Bookmarks bookmarks = response.getBody();

			return bookmarks;
		}

		@Override
		protected void onPostExecute(Bookmarks result) {
			adapter.updateBookmarks(result);
			bookmarkList.startAnimation(fadeIn);
		}
		
	}

	void bookmarkListItemClicked(Bookmark selectedBookmark) {
		clipboardManager.setText(selectedBookmark.getUrl());
	}

}
                ]]></script>
            </div>
            <div class="column">
                <h3>After</h3>
                <script type="syntaxhighlighter" class="brush: java"><![CDATA[
@NoTitle
@Fullscreen
@EActivity(R.layout.bookmarks)
public class BookmarksToClipboardActivity extends Activity {
	
	BookmarkAdapter adapter;
	
	@ViewById
	ListView bookmarkList;

	@ViewById
	EditText search;
	
	@App
	BookmarkApplication application;
	
	@RestService
	BookmarkClient restClient;

	@AnimationRes
	Animation fadeIn;
	
	@SystemService
	ClipboardManager clipboardManager;

	@AfterViews
	void initBookmarkList() {
		adapter = new BookmarkAdapter(this);
		bookmarkList.setAdapter(adapter);
	}
	
	@Click({R.id.updateBookmarksButton1, R.id.updateBookmarksButton2})
	void updateBookmarksClicked() {
		searchAsync(search.getText().toString(), application.getUserId());
	}
	
	@Background
	void searchAsync(String searchString, String userId) {
		Bookmarks bookmarks = restClient.getBookmarks(searchString, userId);
		updateBookmarks(bookmarks);
	}

	@UiThread
	void updateBookmarks(Bookmarks bookmarks) {
		adapter.updateBookmarks(bookmarks);
		bookmarkList.startAnimation(fadeIn);
	}
	
	@ItemClick
	void bookmarkListItemClicked(Bookmark selectedBookmark) {
		clipboardManager.setText(selectedBookmark.getUrl());
	}

}
                ]]></script>
                <pre class="brush: java">
@Rest("http://www.bookmarks.com")
public interface BookmarkClient {
	
	@Get("/bookmarks/{userId}?search={search}")
	Bookmarks getBookmarks(String search, String userId);

}
                </pre>
                
                
            </div>

		</article>
	</div>
	<div id="footer-container">
		<footer class="wrapper">
			<p>Copyright 2012 &copy; Android Annotations - 
            <a href="#">Google Plus</a>
            <a href="#">Google code</a>
            <a href="#">Twitter</a>
            </p>
		</footer>
	</div>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="js/libs/jquery-1.6.2.min.js"><\/script>')</script>
<script type="text/javascript">
         SyntaxHighlighter.all()
</script>

<!-- scripts concatenated and minified via ant build script-->
<script src="js/plugins.js"></script>
<script src="js/script.js"></script>
<!-- end scripts-->

</body>
</html>
